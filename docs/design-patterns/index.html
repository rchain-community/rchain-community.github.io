<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <meta name="google-site-verification" content="ZLLy5UOPYx66Dl5yzaWabg3CLJNbc4AQuaEEgcB-bRw" />
    <title>Design patterns - Rchain network</title><meta name="gridsome:hash" content="cd7697788bd7967fde6d4e84589e4ea257415f43"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="👉 Rholang is an open and scalable blockchain language designed for speed and reliability. Build on latest research from the reflective high order calculus."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.563b6e448255041815a11f28043b4a2a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.563b6e448255041815a11f28043b4a2a.png"><link rel="preload" href="/assets/css/1.styles.63b0d45d.css" as="style"><link rel="preload" href="/assets/js/app.8489218a.js" as="script"><link rel="stylesheet" href="/assets/css/1.styles.63b0d45d.css"><style data-vue-tag="ssr" type="text/css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.9rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.46978rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.29271rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87953rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.82485rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;font-size:0.85rem;line-height:1.6rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.6rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.6rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.6rem / 2);margin-top:calc(1.6rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.6rem / 2);margin-top:calc(1.6rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.6rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light');
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" dark="" data-server-rendered="true" class="has-sidebar docs-page"><header><div class="header-inner container flex gap-30"><div oncontextmenu="return false;" class="logo"><a href="/" title="Back to home" class="logo__link active"><img alt="Rholang.org" src="/assets/static/rholang-logo.7ba8522.521690c0ed4db5f7c60f927c2c5e4cc0.svg" width="200" srcset="/assets/static/rholang-logo.7ba8522.521690c0ed4db5f7c60f927c2c5e4cc0.svg 200w" sizes="(max-width: 200px) 100vw, 200px" class="logo__svg hide-for-small g-image"><img alt="Rholang.org" src="/assets/static/rholang-logo-small.7ba8522.4177bad4657dff7dd80533d9c1fffd10.svg" width="200" srcset="/assets/static/rholang-logo-small.7ba8522.4177bad4657dff7dd80533d9c1fffd10.svg 200w" sizes="(max-width: 200px) 100vw, 200px" class="logo__svg show-for-small logo__svg--small g-image"></a></div><nav class="main-nav flex gap-15 flex-fit"><a href="/docs" class="active"><span class="main-nav__label">Docs</span></a><a href="/tutorials"><span class="main-nav__label">Tutorials</span></a><a href="/dapps"><span class="main-nav__label">dApps</span></a><a href="/blog/"><span class="main-nav__label">Blog</span></a></nav><form id="search" class="header-search"><label><input id="search-input" placeholder="Search Rholang docs..." title="Search docs" type="search" class="header-search__input"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></label></form><nav class="header-actions flex"><a role="button" aria-label="Toggle dark" title="Toggle dark" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></a><a aria-label="Twitter" href="//twitter.com/rchain_coop?lang=en" rel="noopener noreferrer" target="_blank" title="Join us on twitter" class="hide-for-small"><svg width="18" height="18" viewBox="0 0 612 612"><path fill="currentColor" d="M612 116.258a250.714 250.714 0 01-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 01-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"></path></svg></a><a aria-label="Discord" href="//discord.gg/NWkQnfH" rel="noopener noreferrer" target="_blank" title="Join our discord" class="hide-for-small"><svg width="22" height="22" viewBox="0 0 245 240"><path fill="currentColor" d="M104.4 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1.1-6.1-4.5-11.1-10.2-11.1zm36.5 0c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1s-4.5-11.1-10.2-11.1z"></path><path fill="currentColor" d="M189.5 20h-134C44.2 20 35 29.2 35 40.6v135.2c0 11.4 9.2 20.6 20.5 20.6h113.4l-5.3-18.5 12.8 11.9 12.1 11.2 21.5 19V40.6c0-11.4-9.2-20.6-20.5-20.6zm-38.6 130.6s-3.6-4.3-6.6-8.1c13.1-3.7 18.1-11.9 18.1-11.9-4.1 2.7-8 4.6-11.5 5.9-5 2.1-9.8 3.5-14.5 4.3-9.6 1.8-18.4 1.3-25.9-.1-5.7-1.1-10.6-2.7-14.7-4.3-2.3-.9-4.8-2-7.3-3.4-.3-.2-.6-.3-.9-.5-.2-.1-.3-.2-.4-.3-1.8-1-2.8-1.7-2.8-1.7s4.8 8 17.5 11.8c-3 3.8-6.7 8.3-6.7 8.3-22.1-.7-30.5-15.2-30.5-15.2 0-32.2 14.4-58.3 14.4-58.3 14.4-10.8 28.1-10.5 28.1-10.5l1 1.2c-18 5.2-26.3 13.1-26.3 13.1s2.2-1.2 5.9-2.9c10.7-4.7 19.2-6 22.7-6.3.6-.1 1.1-.2 1.7-.2 6.1-.8 13-1 20.2-.2 9.5 1.1 19.7 3.9 30.1 9.6 0 0-7.9-7.5-24.9-12.7l1.4-1.6s13.7-.3 28.1 10.5c0 0 14.4 26.1 14.4 58.3 0 0-8.5 14.5-30.6 15.2z"></path></svg></a><div class="has-dropdown"><a aria-label="github" href="//github.com/rchain/rchain" rel="noopener noreferrer" target="_blank" title="Rchain @ GitHub"><svg width="20px" height="20px" viewBox="0 0 438.549 438.549"><path fill="currentColor" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></svg><span class="hide-for-small" style="margin-left:5px;">v0.1.0</span></a><div class="dropdown"><a href="//github.com/rchain/rchain" rel="noopener noreferrer" target="_blank">Core Repository</a><a href="https://github.com/rchain-community" rel="noopener noreferrer" target="_blank">Rchain Community</a><a href="https://github.com/tgrospic/rnode-client-js" rel="noopener noreferrer" target="_blank">RNode Client</a><a href="https://github.com/fabcotech/rchain-toolkit" rel="noopener noreferrer" target="_blank">Rchain Toolkit</a><a href="https://github.com/rchain-community/rchain-wallet" rel="noopener noreferrer" target="_blank">RchainWallet</a><a href="https://github.com/imphila/Capo" rel="noopener noreferrer" target="_blank">Capo Mobile App</a><a href="https://github.com/dimworm/rui" rel="noopener noreferrer" target="_blank">Rui锐 Chrome Wallet</a><a href="https://github.com/rchain-community/rchain-community.github.io" rel="noopener noreferrer" target="_blank">Rholang Website</a></div></div></nav></div></header><div class="container flex flex-align-top"><div class="sidebar"><h3 class="menu-item">Development</h3><a href="/docs/" class="menu-item menu-link">
            Development
          </a><a href="/docs/network-configuration/" class="menu-item menu-link">
            Network Configuration
          </a><a href="/docs/installing-rnode/" class="menu-item menu-link">
            Installing RNode
          </a><a href="/docs/running-rnode/" class="menu-item menu-link">
            Running RNode (non-Docker)
          </a><a href="/docs/running-rnode-docker/" class="menu-item menu-link">
            Running RNode (Docker)
          </a><h3 class="menu-item">Rholang</h3><a href="/docs/rholang/" class="menu-item menu-link">
            Rholang
          </a><a href="/docs/names-processes/" class="menu-item menu-link">
            Names and Processes
          </a><a href="/docs/expressions/" class="menu-item menu-link">
            Expressions
          </a><a href="/docs/send-receive/" class="menu-item menu-link">
            Sending and Receiving
          </a><a href="/docs/pattern-match/" class="menu-item menu-link">
            Pattern matching
          </a><a href="/docs/iteration/" class="menu-item menu-link">
            Iteration
          </a><a href="/docs/design-patterns/" aria-current="page" class="menu-item menu-link active--exact active">
            Design patterns
          </a><a href="/docs/rholang-cost-accounting" class="menu-item menu-link">
            Cost accounting
          </a><h3 class="menu-item">RNode</h3><a href="/docs/commands/" class="menu-item menu-link">
            Commands for RNode
          </a><a href="/docs/deploy-contract/" class="menu-item menu-link">
            Deploy a Rholang contract
          </a><a href="/docs/propose-block/" class="menu-item menu-link">
            Propose a block to the blockchain
          </a><a href="/docs/block-finalization/" class="menu-item menu-link">
            Check block finalization
          </a><h3 class="menu-item">Rspace</h3><a href="/docs/rspace-intro/" class="menu-item menu-link">
            Overview
          </a><a href="/docs/rspace-tut/" class="menu-item menu-link">
            Implementation Scala
          </a><a href="/docs/rspace-tut-rust/" class="menu-item menu-link">
            Implementation Rust
          </a><h3 class="menu-item">Validator</h3><a href="/docs/cbc-protocol/" class="menu-item menu-link">
            Current state of the protocol
          </a><a href="/docs/bonding-network/" class="menu-item menu-link">
            What are Validators
          </a><a href="/docs/bonding-validator/" class="menu-item menu-link">
            Run a Standalone Validator
          </a><a href="/docs/rchain-network-docker/" class="menu-item menu-link">
            Run a Rchain Network (docker)
          </a><a href="/docs/rchain-network-terraform/" class="menu-item menu-link">
            Run a Rchain Network (terraform)
          </a><h3 class="menu-item">Shards</h3><a href="/docs/sharding-proposal/" class="menu-item menu-link">
            Sharding Proposal
          </a><a href="/docs/sharding-definitions/" class="menu-item menu-link">
            Sharding Definitions
          </a><a href="/docs/sharding-localized/" class="menu-item menu-link">
            Sharding Localized Processes
          </a><a href="/docs/powerset-shards/" class="menu-item menu-link">
            Powerset Shards
          </a><h3 class="menu-item">Research</h3><a href="/docs/research/" class="menu-item menu-link">
            Research
          </a><a href="/docs/history-blockchain/" class="menu-item menu-link">
            History Blockchain
          </a></div><section class="section doc-content flex-fit"><div class="section--inner container container-base"><div class="post mb"><h1 id="design-patterns"><a href="#design-patterns" aria-hidden="true">#</a>Design patterns</h1><p>Here you find some patterns you will often use to solve same Tasks.</p><h2 id="mutable-state"><a href="#mutable-state" aria-hidden="true">#</a>Mutable state</h2><pre class="language-javascript{numberLines:"><code class="language-javascript{numberLines:">  new MakeCell in {
    // Makes a single cell in which you can store values
    contract MakeCell(@init, get, set) = {
      new valueStore in {
        valueStore!(init) |
        contract get(ack) = {
          for(@value &lt;- valueStore) {
            valueStore!(value) | ack!(value)
          }
        } |
        contract set(@newValue, ack) = {
          for(_ &lt;- valueStore) {
            valueStore!(newValue) | ack!(true)
          }
        }
      }
    } |
    // Cell usage.
    new myGet, mySet in {
      MakeCell!(123, *myGet, *mySet) |
      new ack in {
        myGet!(*ack) |
        for (@result &lt;- ack) {
          //result now contains the value 123
          mySet!(456, *ack) |
          for (_ &lt;- ack) {
            myGet!(*ack) |
            for (@result &lt;- ack) {
              //result now contains the value 456
              Nil
            }
          }
        }
      }
    }
  }</code></pre><p>1.) We create a new channel MakeCell and then use it on lineas the name of an internal contract. No process other than the code inside this lexical scope can invoke it.</p><p>3.) The <em>MakeCell</em> contract takes three arguments. The first argument is the initial value to be stored in the cell. The second and third arguments are channels over which the cell will receive requests to get and set the value. Note that we want the first argument to be a process and the second and third to be names, but names are always received over channels so we need to make the first argument a pattern beginning with <em>@</em> to indicate that the name we receive as the first argument is a quoted process and it is that process which we want to bind to the variable.</p><p>4.) To store the value, we create a new channel. This channel will have at most one message on it containing the current value of the cell.</p><p>5.) Before this line, there are no messages on the <em>valueStore</em> channel. After we send the initial value, it is the only value on that channel.</p><p>6.) We set up a contract to listen on the <em>get</em> channel. Each time a message is sent on <em>get</em>, the body of the contract will be executed</p><p>7.) We block until we get one message from the <em>valueStore</em> channel. Because there is at most one message ever waiting on <em>valueStore</em>, reading the message behaves much like acquiring a lock.</p><p>8.) We send the current value on <em>valueStore</em> again, allowing other messages to be processed (i.e. releasing the lock), and we send the current value back to the client on the <em>ack</em> channel.</p><p>11.) Concurrently with the <em>get</em> contract, we run a contract listening on <em>set</em>.</p><p>12.) We block until there's a message on <em>valueStore</em>, then read it. We throw away the message that we read.</p><p>13.) We send the new value to store on <em>valueStore</em> and signal that the operation is complete.</p><p>18-36) The usage code demonstrates creating a cell, assigning the initial value 123, getting that value, setting the value to 456, then getting that value.</p><p>Note the deep layers of callback. Rholang was designed to make concurrent computations natural to express; as a consequence, data dependencies implicit in sequencing in other languages must be made explicit.</p><h2 id="coat-check"><a href="#coat-check" aria-hidden="true">#</a>Coat check</h2><pre class="language-javascript{numberLines:"><code class="language-javascript{numberLines:">  new MakeCoatCheck in {
    contract MakeCoatCheck(ret) = {
      new port, table in {
        ret!(*port) |
        for(@&quot;new&quot;, @arg, ack &lt;= port) {
          new ticket in {
            ack!(*ticket) |
            @{*ticket | *table}!(arg)
          }
        } |
        for(@&quot;get&quot;, @arg, ack &lt;= port) {
          for (@value &lt;- @{arg | *table}) {
            @{arg | *table}!(value) |
            ack!(value)
          }
        } |
        for(@&quot;set&quot;, @arg1, @arg2, ack &lt;= port) {
          for (_ &lt;- @{arg1 | *table}) {
            @{arg1 | *table}!(arg2) |
            ack!(true)
          }
        }
      }
    } |

  // Usage
  new ret, get, set in {
    MakeCoatCheck!(*ret) |
    for (cc &lt;- ret) {
      // Creates new cell with initial value 0
      cc!(&quot;new&quot;, 0, *ret) |
      for (ticket &lt;- ret) {
        contract get(return) = { cc!(&quot;get&quot;, *ticket, *return) } |
        contract set(@value, return) = { cc!(&quot;set&quot;, *ticket, value, *return) } |

        get!(*ret) | for(@r &lt;- ret) {
          //r is equal to 0
          set!(1, *ret) | for(_ &lt;- ret) {
            get!(*ret) | for(@r &lt;- ret) {
              //r is equal to 1
              Nil
            }
          }
        }
        }
      }
    }
  }</code></pre><p>2.) One design pattern, used in the MakeCell contract above, is to receive from the caller a channel for each different piece of functionality that a process provides. An object-oriented programmer might say that MakeCell requires the caller to provide a channel for each method. MakeCoatCheck uses a more object-oriented approach, as we'll see.</p><p>3.) We create a <em>port</em> channel for interacting with the coat check as well as a <em>table</em> name which will be used in storing/retrieving values in the coat check.</p><p>4.) We send <em>port</em> out to the caller, so they can interact with the coat check.</p><p>5, 11, 17) We define different methods which can be called by sending a message on <em>port</em>. This is done by specifying mutually exclusive patterns the message on <em>port</em> can match, with the first element of the message being the method name and subsequent elements being the argument(s) and return channel. Using the <em>&lt;=</em> arrow instead of the <em>&lt;-</em> arrow means that the <em>for</em>s are &quot;replicated&quot;. This gives them the same behavior as <em>contract</em>s, i.e. the process listening for messages on <em>port</em> persists after spawning an instance of its body.</p><p>8.) We take advantage of being able to quote any process to make a name in order to create a unique name for each value to be stored at. The process *<em>ticket | </em>table<em> is produced by the concurrent composition of the processes produced by unquoting the names </em>ticket<em> and </em>table*. That process can then be quoted to form a unique name that is then used to store the value by sending it on the name.</p><h2 id="dining-philosophers-and-deadlock"><a href="#dining-philosophers-and-deadlock" aria-hidden="true">#</a>Dining philosophers and deadlock</h2><pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">new</span> <span class="token class-name">philosopher1</span><span class="token punctuation">,</span> philosopher2<span class="token punctuation">,</span> north<span class="token punctuation">,</span> south<span class="token punctuation">,</span> knife<span class="token punctuation">,</span> spoon <span class="token keyword">in</span> <span class="token punctuation">{</span>
    north<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>knife<span class="token punctuation">)</span> <span class="token operator">|</span>
    south<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>spoon<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@knf <span class="token operator">&lt;</span><span class="token operator">-</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@spn <span class="token operator">&lt;</span><span class="token operator">-</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      philosopher1<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;Complete!&quot;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
      north<span class="token operator">!</span><span class="token punctuation">(</span>knf<span class="token punctuation">)</span> <span class="token operator">|</span>
      south<span class="token operator">!</span><span class="token punctuation">(</span>spn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">|</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@spn <span class="token operator">&lt;</span><span class="token operator">-</span> south<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@knf <span class="token operator">&lt;</span><span class="token operator">-</span> north<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      philosopher2<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;Complete!&quot;</span><span class="token punctuation">)</span> <span class="token operator">|</span>
      north<span class="token operator">!</span><span class="token punctuation">(</span>knf<span class="token punctuation">)</span> <span class="token operator">|</span>
      south<span class="token operator">!</span><span class="token punctuation">(</span>spn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre><p>The dining philosophers problem has two philosophers that share only one set of silverware. Philosopher1 sits on the east side of the table while Philosopher2 sits on the west. Each needs both a knife and a spoon in order to eat. Each one refuses to relinquish a utensil until he has used both to take a bite. If both philosophers reach first for the utensil at their right, both will starve: Philosopher1 gets the knife, Philosopher2 gets the spoon, and neither ever lets go.</p><p>Here's how to solve the problem:</p><pre class="language-javascript{numberLines:"><code class="language-javascript{numberLines:">  new philosopher1, philosopher2, north, south, knife, spoon in {
    north!(*knife) |
    south!(*spoon) |
    for (@knf &lt;- north; @spn &lt;- south) {
      philosopher1!(&quot;Complete!&quot;) |
      north!(knf) |
      south!(spn)
    } |
    for (@spn &lt;- south; @knf &lt;- north) {
      philosopher2!(&quot;Complete!&quot;) |
      north!(knf) |
      south!(spn)
    }
  }</code></pre><p>4, 9) The join operator, denoted with a semicolon <em>;</em>, declares that the continuation should only proceed if there is a message available on each of the channels simultaneously, preventing the deadlock above.</p><h2 id="crypto-channels"><a href="#crypto-channels" aria-hidden="true">#</a>Crypto channels</h2><h3 id="hashing"><a href="#hashing" aria-hidden="true">#</a>Hashing</h3><p>There are three hashing functions available:</p><ul><li>keccak256</li><li>sha256</li><li>blake2b256</li></ul><p>Hashing functions are exposed as channels which expect two arguments:</p><ul><li>byte array to hash</li><li>return channel for sending back the hash represented as byte array</li></ul><h3 id="example-usage"><a href="#example-usage" aria-hidden="true">#</a>Example usage:</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">stdout</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rho:io:stdout</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
    x<span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">&quot;name&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;Joe&quot;</span><span class="token punctuation">)</span> <span class="token operator">|</span> @<span class="token string">&quot;age&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">// (1)</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@r <span class="token operator">&lt;</span><span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            @<span class="token string">&quot;keccak256Hash&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token method function property-access">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span> <span class="token comment">// hash the program from (1)</span>
        <span class="token punctuation">}</span> <span class="token operator">|</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@h <span class="token operator">&lt;</span><span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// The h here is the hash of the rholang term we sent to the hash channel.</span>
            <span class="token comment">// We can do anything we want with it, but we choose to just print it.</span>
            <span class="token comment">// Rholang prints byte arrays in hexadecimal.</span>
            stdout<span class="token operator">!</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>  <span class="token comment">// print out the keccak256 hash</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="verify"><a href="#verify" aria-hidden="true">#</a>Verify</h3><ol><li>Let's hash a rholang program and print out it in base16. In rholang:</li></ol><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token function">stdout</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rho:io:stdout</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
    x<span class="token operator">!</span><span class="token punctuation">(</span>@<span class="token string">&quot;name&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;Joe&quot;</span><span class="token punctuation">)</span> <span class="token operator">|</span> @<span class="token string">&quot;age&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span>  <span class="token comment">// (1)</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@r <span class="token operator">&lt;</span><span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> @<span class="token string">&quot;keccak256Hash&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token method function property-access">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">|</span>  <span class="token comment">// hash the program from (1)</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@h <span class="token operator">&lt;</span><span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> stdout<span class="token operator">!</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token comment">// print out the keccak256 hash</span>
<span class="token punctuation">}</span></code></pre><p>This will print the hash of our program <em>(1)</em> :</p><pre class="language-text"><code class="language-text">`a6da46a1dc7ed715d4cd6472a736249a4d11142d160dbef9f20ae493de908c4e`</code></pre><ol start="2"><li>We need a pair of keys; let's generate some with <em>Ed25519</em>, available in the project. In the scala console, we enter the following:</li></ol><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> coop<span class="token punctuation">.</span><span class="token property-access">rchain</span><span class="token punctuation">.</span><span class="token property-access">crypto</span><span class="token punctuation">.</span><span class="token property-access">signatures</span><span class="token punctuation">.</span><span class="token property-access">_</span>
<span class="token keyword module">import</span> coop<span class="token punctuation">.</span><span class="token property-access">rchain</span><span class="token punctuation">.</span><span class="token property-access">crypto</span><span class="token punctuation">.</span><span class="token property-access">codec</span><span class="token punctuation">.</span><span class="token property-access">_</span>

val keyPair <span class="token operator">=</span> <span class="token maybe-class-name">Ed25519</span><span class="token punctuation">.</span><span class="token property-access">newKeyPair</span>
val secKey <span class="token operator">=</span> <span class="token maybe-class-name">Base16</span><span class="token punctuation">.</span><span class="token method function property-access">encode</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">.</span><span class="token property-access">_1</span><span class="token punctuation">)</span>
<span class="token comment">// secKey: String = f6664a95992958bbfeb7e6f50bbca2aa7bfd015aec79820caf362a3c874e9247</span>
val pubKey <span class="token operator">=</span> <span class="token maybe-class-name">Base16</span><span class="token punctuation">.</span><span class="token method function property-access">encode</span><span class="token punctuation">(</span>keyPair<span class="token punctuation">.</span><span class="token property-access">_2</span><span class="token punctuation">)</span>
<span class="token comment">// pubKey: String = 288755c48c3951f89c5f0ffe885088dc0970fd935bc12adfdd81f81bb63d6219</span></code></pre><ol start="3"><li>Now we need to sign the hash we obtained in first step. First we convert the hexadecimal strings we printed earlier back into byte arrays, then sign the result:</li></ol><pre class="language-javascript"><code class="language-javascript">val signature <span class="token operator">=</span> <span class="token maybe-class-name">Ed25519</span><span class="token punctuation">.</span><span class="token method function property-access">sign</span><span class="token punctuation">(</span><span class="token maybe-class-name">Base16</span><span class="token punctuation">.</span><span class="token method function property-access">decode</span><span class="token punctuation">(</span><span class="token string">&quot;a6da46a1dc7ed715d4cd6472a736249a4d11142d160dbef9f20ae493de908c4e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Base16</span><span class="token punctuation">.</span><span class="token method function property-access">decode</span><span class="token punctuation">(</span>secKey<span class="token punctuation">)</span><span class="token punctuation">)</span>
val base16Repr <span class="token operator">=</span> <span class="token maybe-class-name">Base16</span><span class="token punctuation">.</span><span class="token method function property-access">encode</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span>
<span class="token comment">// d0a909078ce8b8706a641b07a0d4fe2108064813ce42009f108f89c2a3f4864aa1a510d6dfccad3b62cd610db0bfe82bcecb08d813997fa7df14972f56017e0b</span></code></pre><ol start="4"><li>Now we can pass the signature and public key to our rholang program to verify it using the available crypto functions.</li></ol><p>The <em>ed25519Verify</em> channel expects four arguments as follows:</p><ul><li>data to verify. In our case, this will be the keccak256 hash of our rholang program. The hash is represented in base16, so we need to call <em>hexToBytes</em> on it to turn the string into byte array</li><li>signature. Again, we have hexadecimal string, so we need to turn it into a byte array with <em>hexToBytes</em>.</li><li>public key. This is the public key corresponding to the private one used to issue the signature.</li><li>channel on which the result of verification will be returned.</li></ul><p>So, in rholang we run:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">,</span> <span class="token function">stdout</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rho:io:stdout</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
  @<span class="token string">&quot;ed25519Verify&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;a6da46a1dc7ed715d4cd6472a736249a4d11142d160dbef9f20ae493de908c4e&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;d0a909078ce8b8706a641b07a0d4fe2108064813ce42009f108f89c2a3f4864aa1a510d6dfccad3b62cd610db0bfe82bcecb08d813997fa7df14972f56017e0b&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;288755c48c3951f89c5f0ffe885088dc0970fd935bc12adfdd81f81bb63d6219&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@v <span class="token operator">&lt;</span><span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> stdout<span class="token operator">!</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>and we should see:</p><pre class="language-javascript"><code class="language-javascript">@<span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></code></pre><p>which means that our signed hash is verified.</p><p>If we, for example, pass in a corrupted hash, changing the initial 'a' to a 'b':</p><pre class="language-javascript"><code class="language-javascript"> <span class="token keyword">new</span> <span class="token class-name">x</span><span class="token punctuation">,</span> <span class="token function">stdout</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rho:io:stdout</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
     @<span class="token string">&quot;ed25519Verify&quot;</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;b6da46a1dc7ed615d4cd6472a736249a4d11142d160dbef9f20ae493de908c4e&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;d0a909078ce8b8706a641b07a0d4fe2108064813ce42009f108f89c2a3f4864aa1a510d6dfccad3b62cd610db0bfe82bcecb08d813997fa7df14972f56017e0b&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;288755c48c3951f89c5f0ffe885088dc0970fd935bc12adfdd81f81bb63d6219&quot;</span><span class="token punctuation">.</span><span class="token method function property-access">hexToBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token operator">|</span>
     <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@v <span class="token operator">&lt;</span><span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> stdout<span class="token operator">!</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre><p>we will get:</p><pre class="language-javascript"><code class="language-javascript">@<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></code></pre><h2 id="secure-design-patterns"><a href="#secure-design-patterns" aria-hidden="true">#</a>Secure design patterns</h2><p>In this section we describe several design patterns. These patterns are adapted from Marc Stiegler's <a href="http://erights.org/talks/efun/SecurityPictureBook.pdf" target="_blank" rel="nofollow noopener noreferrer">A PictureBook of Secure Cooperation</a>.</p><h3 id="facets"><a href="#facets" aria-hidden="true">#</a>Facets</h3><p>In the MakeCell contract, the client provides two channels, one for getting the value and one for setting it. If the client then passes only the <em>get</em> channel to another process, that process effectively has a read-only view of the cell.</p><p>Channels like <em>get</em> and <em>set</em> are called &quot;facets&quot; of the process. They encapsulate the authority to perform the action. If the <em>set</em> channel is a public channel like <em>@&quot;Foo&quot;</em>, then anyone who can learn or even guess the string <em>&quot;Foo&quot;</em> has the authority to set the cell's value. On the other hand, if the <em>set</em> channel was created with the <em>new</em> operator, then there's no way for any other process to construct the <em>set</em> channel; it must be passed to a process directly in order for the process to use it.</p><p>Note that possession of <em>get</em> and <em>set</em> is also authority to intercept messages sent to the cell:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@ret <span class="token operator">&lt;</span><span class="token operator">-</span> get<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token constant">P</span> <span class="token punctuation">}</span> <span class="token operator">|</span>
<span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@ret <span class="token operator">&lt;</span><span class="token operator">-</span> get<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token constant">Q</span> <span class="token punctuation">}</span> <span class="token operator">|</span>
get<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ack<span class="token punctuation">)</span></code></pre><p>This term has two processes listening on the channel <em>get</em> and a single message sent over <em>get</em>. Only one of the two processes will be able to receive the message.</p><p>By receiving channels from the client for getting and setting, the MakeCell contract is leaving the decisions about how public those channels are to the client. The MakeCoatCheck contract, on the other hand, constructs its own channels and exposes methods the client, so it is in a position to enforce privacy guarantees.</p><h3 id="attenuating-forwarders"><a href="#attenuating-forwarders" aria-hidden="true">#</a>Attenuating forwarders</h3><p>In the MakeCoatCheck contract, there's only one channel and messages are dispatched internally. To get the same effect as a read-only facet, we can create a forwarder process that simply ignores any messages it doesn't want to forward. The contract below only forwards the &quot;get&quot; method.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">MakeGetForwarder</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
  contract <span class="token function"><span class="token maybe-class-name">MakeGetForwarder</span></span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">port</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
      ret<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>port<span class="token punctuation">)</span> <span class="token operator">|</span>
      contract <span class="token function">port</span><span class="token punctuation">(</span>@method<span class="token punctuation">,</span> @arg<span class="token punctuation">,</span> ack<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        match method <span class="token operator">==</span> <span class="token string">&quot;get&quot;</span> <span class="token punctuation">{</span> <span class="token parameter"><span class="token boolean">true</span></span> <span class="token arrow operator">=&gt;</span> target<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> arg<span class="token punctuation">,</span> <span class="token operator">*</span>ack<span class="token punctuation">)</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="revocation"><a href="#revocation" aria-hidden="true">#</a>Revocation</h3><p>We can implement revocation by creating a forwarder with a kill switch.</p><pre class="language-javascript{numberLines:"><code class="language-javascript{numberLines:">  new MakeRevokableForwarder in {
    contract MakeRevokableForwarder(target, ret) = {
      new port, kill, forwardFlag in {
        ret!(*port, *kill) |
        forwardFlag!(true) |
        contract port(msg) = {
          for (@status &lt;- forwardFlag) {
            forwardFlag!(status) |
            match status { true =&gt; target!(*msg) }
          }
        } |
        for (_ &lt;- kill; _ &lt;- forwardFlag) {
          forwardFlag!(false)
        }
      }
    }
  }</code></pre><p>3.) We create a port to listen for method calls and a channel <em>forwardFlag</em> to store whether to forward messages.</p><p>4.) We return the channel on which clients send requests and the channel on which to send the kill signal.</p><p>5.) We set the initial state of <em>forwardFlag</em> to true.</p><p>6-11) We read in an arbitrary message, get and replace the value of the flag. If the flag is true, we forward the message to <em>target</em>.</p><p>12-14) If a message is ever sent on the <em>kill</em> channel, we set <em>forwardFlag</em> to false. The forwarder process then stops forwarding messages.</p><h3 id="composition"><a href="#composition" aria-hidden="true">#</a>Composition</h3><p>By combining an attenuating forwarder with a revokable forwarder, we get both features:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ret</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">MakeGetForwarder</span></span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">|</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>@pair <span class="token operator">&lt;</span><span class="token operator">-</span> ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    match pair <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>getOnly<span class="token punctuation">,</span> kill<span class="token punctuation">]</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token maybe-class-name">MakeRevokableForwarder</span><span class="token operator">!</span><span class="token punctuation">(</span>getOnly<span class="token punctuation">,</span> <span class="token operator">*</span>ret<span class="token punctuation">)</span> <span class="token operator">|</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>revokableGetOnly <span class="token operator">&lt;</span><span class="token operator">-</span> ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// give away revokableGetOnly instead of target</span>
          <span class="token comment">// hang onto kill for later revocation</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="logging-forwarder"><a href="#logging-forwarder" aria-hidden="true">#</a>Logging forwarder</h3><p>A logging forwarder can record all messages sent on a channel by echoing them to a second channel.</p><pre class="language-javascript"><code class="language-javascript">contract <span class="token function"><span class="token maybe-class-name">MakeLoggingForwarder</span></span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> logger<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">new</span> <span class="token class-name">port</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>
    ret<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>port<span class="token punctuation">)</span> <span class="token operator">|</span>
    contract <span class="token function">port</span><span class="token punctuation">(</span>@msg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      target<span class="token operator">!</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">|</span>
      logger<span class="token operator">!</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="accountability"><a href="#accountability" aria-hidden="true">#</a>Accountability</h3><p>Suppose Alice has a channel and would like to log Bob's access to it. Bob would like to delegate the use of that channel to Carol and log her access. Each party is free to construct their own logging forwarder around the channel they have received. Alice will hold Bob responsible for whatever Carol does.</p><h3 id="sealing-and-unsealing"><a href="#sealing-and-unsealing" aria-hidden="true">#</a>Sealing and unsealing</h3><pre class="language-javascript"><code class="language-javascript">contract <span class="token function"><span class="token maybe-class-name">MakeSealerUnsealer</span></span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token punctuation">{</span>
  <span class="token keyword">new</span> <span class="token class-name">sealer</span><span class="token punctuation">,</span> unsealer<span class="token punctuation">,</span> ccRet <span class="token keyword">in</span> <span class="token punctuation">{</span>
    ret<span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>sealer<span class="token punctuation">,</span> <span class="token operator">*</span>unsealer<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token maybe-class-name">MakeCoatCheck</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>ccRet<span class="token punctuation">)</span> <span class="token operator">|</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>cc <span class="token operator">&lt;</span><span class="token operator">-</span> ccRet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      contract <span class="token function">sealer</span><span class="token punctuation">(</span>@value<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        cc<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;new&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token operator">*</span>ret<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token operator">|</span>
      contract <span class="token function">unsealer</span><span class="token punctuation">(</span>@ticket<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        cc<span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> ticket<span class="token punctuation">,</span> <span class="token operator">*</span>ret<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>A sealer/unsealer pair gives the same functionality as public keys, but without cryptography. It's merely an attenuation of the coat check described above. This design pattern can be used to sign something on a user's behalf. In the Rholang blockchain tutorial, we'll see that a sealer/unsealer pair even works as a signing/verification pair of keys on the blockchain because there are no secrets to store, only unforgeable names to be kept inaccessible.</p><h3 id="beware-of-sending-attenuators"><a href="#beware-of-sending-attenuators" aria-hidden="true">#</a>Beware of sending attenuators</h3><p>A basic principle to keep in mind with RChain processes is one that is similar to more traditional web applications: whatever code you send to another party can be disassembled. Ever since the late 1990s when buying things over the web became possible, <a href="https://blog.detectify.com/2016/11/17/7-most-common-e-commerce-security-mistakes/" target="_blank" rel="nofollow noopener noreferrer">there have been e-commerce platforms</a> where the platform relied on the users' browsers to send the correct price of the item back to it. The authors didn't think about the user opening the developer tools and changing the price before it got sent back. The right way to build an e-commerce platform is to store the prices on the server and check them there.</p><p>Suppose that Bob is willing to run some code for Alice; he has a contract that says something like, &quot;Get a process from this channel and run it.&quot;</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span><span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">*</span>p <span class="token punctuation">}</span></code></pre><p>This is just like a web browser being willing to run the JavaScript code it gets from a website. If Alice sends Bob an attenuating forwarder, Bob can use the pattern matching productions in Rholang to take apart the process and get access to the underlying resource. Instead, like in the e-commerce example, Alice should only send code that forwards requests to her own processes and do the attenuation there.</p><h2 id="conclusion"><a href="#conclusion" aria-hidden="true">#</a>Conclusion</h2><p>Rholang is a language designed for use on a blockchain, but we have not mentioned anything about nodes, namespaces, wallets, Rev and phlogiston, network structure, or Casper. A forthcoming document will address all these issues and more.</p><p>We hope that the foregoing examples spark a desire to write more code and demonstrate the ease of expressing concurrent designs.</p></div><p><a href="https://github.com/rchain-community/rchain-community.github.io/tree/source/content/docs/design-patterns.md" target="_blank" class="github-edit-link"><svg width="16" height="16" viewBox="0 0 438.549 438.549"><path fill="currentColor" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></svg><span>Edit this page on GitHub</span></a></p><nav class="docs-nav"><div class="docs-nav__previous"><a href="/docs/iteration/" class="button  button--small docs-nav__link">
            ← Iteration
          </a></div><div class="docs-nav__next"><a href="/docs/rholang-cost-accounting" class="button  button--small docs-nav__link">
            Cost accounting →
          </a></div></nav></div><!----></section><div class="sidebar sidebar--right hide-for-small"><h3>On this page</h3><ul class="menu-item submenu"><li class="submenu__item submenu__item-depth-2"><a href="#mutable-state" class="submenu__link">
            Mutable state
          </a></li><li class="submenu__item submenu__item-depth-2"><a href="#coat-check" class="submenu__link">
            Coat check
          </a></li><li class="submenu__item submenu__item-depth-2"><a href="#dining-philosophers-and-deadlock" class="submenu__link">
            Dining philosophers and deadlock
          </a></li><li class="submenu__item submenu__item-depth-2"><a href="#crypto-channels" class="submenu__link">
            Crypto channels
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#hashing" class="submenu__link">
            Hashing
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#example-usage" class="submenu__link">
            Example usage:
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#verify" class="submenu__link">
            Verify
          </a></li><li class="submenu__item submenu__item-depth-2"><a href="#secure-design-patterns" class="submenu__link">
            Secure design patterns
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#facets" class="submenu__link">
            Facets
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#attenuating-forwarders" class="submenu__link">
            Attenuating forwarders
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#revocation" class="submenu__link">
            Revocation
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#composition" class="submenu__link">
            Composition
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#logging-forwarder" class="submenu__link">
            Logging forwarder
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#accountability" class="submenu__link">
            Accountability
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#sealing-and-unsealing" class="submenu__link">
            Sealing and unsealing
          </a></li><li class="submenu__item submenu__item-depth-3"><a href="#beware-of-sending-attenuators" class="submenu__link">
            Beware of sending attenuators
          </a></li><li class="submenu__item submenu__item-depth-2"><a href="#conclusion" class="submenu__link">
            Conclusion
          </a></li></ul></div></div></div>
    <script>window.__INITIAL_STATE__={"data":{"doc":{"title":"Design patterns","headings":[{"value":"Design patterns"}],"subtitles":[{"depth":1,"value":"Design patterns","anchor":"#design-patterns"},{"depth":2,"value":"Mutable state","anchor":"#mutable-state"},{"depth":2,"value":"Coat check","anchor":"#coat-check"},{"depth":2,"value":"Dining philosophers and deadlock","anchor":"#dining-philosophers-and-deadlock"},{"depth":2,"value":"Crypto channels","anchor":"#crypto-channels"},{"depth":3,"value":"Hashing","anchor":"#hashing"},{"depth":3,"value":"Example usage:","anchor":"#example-usage"},{"depth":3,"value":"Verify","anchor":"#verify"},{"depth":2,"value":"Secure design patterns","anchor":"#secure-design-patterns"},{"depth":3,"value":"Facets","anchor":"#facets"},{"depth":3,"value":"Attenuating forwarders","anchor":"#attenuating-forwarders"},{"depth":3,"value":"Revocation","anchor":"#revocation"},{"depth":3,"value":"Composition","anchor":"#composition"},{"depth":3,"value":"Logging forwarder","anchor":"#logging-forwarder"},{"depth":3,"value":"Accountability","anchor":"#accountability"},{"depth":3,"value":"Sealing and unsealing","anchor":"#sealing-and-unsealing"},{"depth":3,"value":"Beware of sending attenuators","anchor":"#beware-of-sending-attenuators"},{"depth":2,"value":"Conclusion","anchor":"#conclusion"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.8489218a.js" defer></script>
  </body>
</html>