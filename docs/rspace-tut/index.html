<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <meta name="google-site-verification" content="ZLLy5UOPYx66Dl5yzaWabg3CLJNbc4AQuaEEgcB-bRw" />
    <title>An RSpace tutorial - Rchain network</title><meta name="gridsome:hash" content="cd7697788bd7967fde6d4e84589e4ea257415f43"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="👉 Rholang is an open and scalable blockchain language designed for speed and reliability. Build on latest research from the reflective high order calculus."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.563b6e448255041815a11f28043b4a2a.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.563b6e448255041815a11f28043b4a2a.png"><link rel="preload" href="/assets/css/1.styles.63b0d45d.css" as="style"><link rel="preload" href="/assets/js/app.8489218a.js" as="script"><link rel="stylesheet" href="/assets/css/1.styles.63b0d45d.css"><style data-vue-tag="ssr" type="text/css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.6 'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.9rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.46978rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.29271rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87953rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:inherit;font-family:'Jost','Helvetica','Helvetica Neue','Segoe UI','Helvetica','Arial',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.82485rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;font-size:0.85rem;line-height:1.6rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}blockquote{margin-left:1.6rem;margin-right:1.6rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.6rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.6rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.6rem / 2);margin-top:calc(1.6rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.6rem / 2);margin-top:calc(1.6rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.6rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light');
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" dark="" data-server-rendered="true" class="has-sidebar docs-page"><header><div class="header-inner container flex gap-30"><div oncontextmenu="return false;" class="logo"><a href="/" title="Back to home" class="logo__link active"><img alt="Rholang.org" src="/assets/static/rholang-logo.7ba8522.521690c0ed4db5f7c60f927c2c5e4cc0.svg" width="200" srcset="/assets/static/rholang-logo.7ba8522.521690c0ed4db5f7c60f927c2c5e4cc0.svg 200w" sizes="(max-width: 200px) 100vw, 200px" class="logo__svg hide-for-small g-image"><img alt="Rholang.org" src="/assets/static/rholang-logo-small.7ba8522.4177bad4657dff7dd80533d9c1fffd10.svg" width="200" srcset="/assets/static/rholang-logo-small.7ba8522.4177bad4657dff7dd80533d9c1fffd10.svg 200w" sizes="(max-width: 200px) 100vw, 200px" class="logo__svg show-for-small logo__svg--small g-image"></a></div><nav class="main-nav flex gap-15 flex-fit"><a href="/docs" class="active"><span class="main-nav__label">Docs</span></a><a href="/tutorials"><span class="main-nav__label">Tutorials</span></a><a href="/dapps"><span class="main-nav__label">dApps</span></a><a href="/blog/"><span class="main-nav__label">Blog</span></a></nav><form id="search" class="header-search"><label><input id="search-input" placeholder="Search Rholang docs..." title="Search docs" type="search" class="header-search__input"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></label></form><nav class="header-actions flex"><a role="button" aria-label="Toggle dark" title="Toggle dark" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></a><a aria-label="Twitter" href="//twitter.com/rchain_coop?lang=en" rel="noopener noreferrer" target="_blank" title="Join us on twitter" class="hide-for-small"><svg width="18" height="18" viewBox="0 0 612 612"><path fill="currentColor" d="M612 116.258a250.714 250.714 0 01-72.088 19.772c25.929-15.527 45.777-40.155 55.184-69.411-24.322 14.379-51.169 24.82-79.775 30.48-22.907-24.437-55.49-39.658-91.63-39.658-69.334 0-125.551 56.217-125.551 125.513 0 9.828 1.109 19.427 3.251 28.606-104.326-5.24-196.835-55.223-258.75-131.174-10.823 18.51-16.98 40.078-16.98 63.101 0 43.559 22.181 81.993 55.835 104.479a125.556 125.556 0 01-56.867-15.756v1.568c0 60.806 43.291 111.554 100.693 123.104-10.517 2.83-21.607 4.398-33.08 4.398-8.107 0-15.947-.803-23.634-2.333 15.985 49.907 62.336 86.199 117.253 87.194-42.947 33.654-97.099 53.655-155.916 53.655-10.134 0-20.116-.612-29.944-1.721 55.567 35.681 121.536 56.485 192.438 56.485 230.948 0 357.188-191.291 357.188-357.188l-.421-16.253c24.666-17.593 46.005-39.697 62.794-64.861z"></path></svg></a><a aria-label="Discord" href="//discord.gg/NWkQnfH" rel="noopener noreferrer" target="_blank" title="Join our discord" class="hide-for-small"><svg width="22" height="22" viewBox="0 0 245 240"><path fill="currentColor" d="M104.4 103.9c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1.1-6.1-4.5-11.1-10.2-11.1zm36.5 0c-5.7 0-10.2 5-10.2 11.1s4.6 11.1 10.2 11.1c5.7 0 10.2-5 10.2-11.1s-4.5-11.1-10.2-11.1z"></path><path fill="currentColor" d="M189.5 20h-134C44.2 20 35 29.2 35 40.6v135.2c0 11.4 9.2 20.6 20.5 20.6h113.4l-5.3-18.5 12.8 11.9 12.1 11.2 21.5 19V40.6c0-11.4-9.2-20.6-20.5-20.6zm-38.6 130.6s-3.6-4.3-6.6-8.1c13.1-3.7 18.1-11.9 18.1-11.9-4.1 2.7-8 4.6-11.5 5.9-5 2.1-9.8 3.5-14.5 4.3-9.6 1.8-18.4 1.3-25.9-.1-5.7-1.1-10.6-2.7-14.7-4.3-2.3-.9-4.8-2-7.3-3.4-.3-.2-.6-.3-.9-.5-.2-.1-.3-.2-.4-.3-1.8-1-2.8-1.7-2.8-1.7s4.8 8 17.5 11.8c-3 3.8-6.7 8.3-6.7 8.3-22.1-.7-30.5-15.2-30.5-15.2 0-32.2 14.4-58.3 14.4-58.3 14.4-10.8 28.1-10.5 28.1-10.5l1 1.2c-18 5.2-26.3 13.1-26.3 13.1s2.2-1.2 5.9-2.9c10.7-4.7 19.2-6 22.7-6.3.6-.1 1.1-.2 1.7-.2 6.1-.8 13-1 20.2-.2 9.5 1.1 19.7 3.9 30.1 9.6 0 0-7.9-7.5-24.9-12.7l1.4-1.6s13.7-.3 28.1 10.5c0 0 14.4 26.1 14.4 58.3 0 0-8.5 14.5-30.6 15.2z"></path></svg></a><div class="has-dropdown"><a aria-label="github" href="//github.com/rchain/rchain" rel="noopener noreferrer" target="_blank" title="Rchain @ GitHub"><svg width="20px" height="20px" viewBox="0 0 438.549 438.549"><path fill="currentColor" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></svg><span class="hide-for-small" style="margin-left:5px;">v0.1.0</span></a><div class="dropdown"><a href="//github.com/rchain/rchain" rel="noopener noreferrer" target="_blank">Core Repository</a><a href="https://github.com/rchain-community" rel="noopener noreferrer" target="_blank">Rchain Community</a><a href="https://github.com/tgrospic/rnode-client-js" rel="noopener noreferrer" target="_blank">RNode Client</a><a href="https://github.com/fabcotech/rchain-toolkit" rel="noopener noreferrer" target="_blank">Rchain Toolkit</a><a href="https://github.com/rchain-community/rchain-wallet" rel="noopener noreferrer" target="_blank">RchainWallet</a><a href="https://github.com/imphila/Capo" rel="noopener noreferrer" target="_blank">Capo Mobile App</a><a href="https://github.com/dimworm/rui" rel="noopener noreferrer" target="_blank">Rui锐 Chrome Wallet</a><a href="https://github.com/rchain-community/rchain-community.github.io" rel="noopener noreferrer" target="_blank">Rholang Website</a></div></div></nav></div></header><div class="container flex flex-align-top"><div class="sidebar"><h3 class="menu-item">Development</h3><a href="/docs/" class="menu-item menu-link">
            Development
          </a><a href="/docs/network-configuration/" class="menu-item menu-link">
            Network Configuration
          </a><a href="/docs/installing-rnode/" class="menu-item menu-link">
            Installing RNode
          </a><a href="/docs/running-rnode/" class="menu-item menu-link">
            Running RNode (non-Docker)
          </a><a href="/docs/running-rnode-docker/" class="menu-item menu-link">
            Running RNode (Docker)
          </a><h3 class="menu-item">Rholang</h3><a href="/docs/rholang/" class="menu-item menu-link">
            Rholang
          </a><a href="/docs/names-processes/" class="menu-item menu-link">
            Names and Processes
          </a><a href="/docs/expressions/" class="menu-item menu-link">
            Expressions
          </a><a href="/docs/send-receive/" class="menu-item menu-link">
            Sending and Receiving
          </a><a href="/docs/pattern-match/" class="menu-item menu-link">
            Pattern matching
          </a><a href="/docs/iteration/" class="menu-item menu-link">
            Iteration
          </a><a href="/docs/design-patterns/" class="menu-item menu-link">
            Design patterns
          </a><a href="/docs/rholang-cost-accounting" class="menu-item menu-link">
            Cost accounting
          </a><h3 class="menu-item">RNode</h3><a href="/docs/commands/" class="menu-item menu-link">
            Commands for RNode
          </a><a href="/docs/deploy-contract/" class="menu-item menu-link">
            Deploy a Rholang contract
          </a><a href="/docs/propose-block/" class="menu-item menu-link">
            Propose a block to the blockchain
          </a><a href="/docs/block-finalization/" class="menu-item menu-link">
            Check block finalization
          </a><h3 class="menu-item">Rspace</h3><a href="/docs/rspace-intro/" class="menu-item menu-link">
            Overview
          </a><a href="/docs/rspace-tut/" aria-current="page" class="menu-item menu-link active--exact active">
            Implementation Scala
          </a><a href="/docs/rspace-tut-rust/" class="menu-item menu-link">
            Implementation Rust
          </a><h3 class="menu-item">Validator</h3><a href="/docs/cbc-protocol/" class="menu-item menu-link">
            Current state of the protocol
          </a><a href="/docs/bonding-network/" class="menu-item menu-link">
            What are Validators
          </a><a href="/docs/bonding-validator/" class="menu-item menu-link">
            Run a Standalone Validator
          </a><a href="/docs/rchain-network-docker/" class="menu-item menu-link">
            Run a Rchain Network (docker)
          </a><a href="/docs/rchain-network-terraform/" class="menu-item menu-link">
            Run a Rchain Network (terraform)
          </a><h3 class="menu-item">Shards</h3><a href="/docs/sharding-proposal/" class="menu-item menu-link">
            Sharding Proposal
          </a><a href="/docs/sharding-definitions/" class="menu-item menu-link">
            Sharding Definitions
          </a><a href="/docs/sharding-localized/" class="menu-item menu-link">
            Sharding Localized Processes
          </a><a href="/docs/powerset-shards/" class="menu-item menu-link">
            Powerset Shards
          </a><h3 class="menu-item">Research</h3><a href="/docs/research/" class="menu-item menu-link">
            Research
          </a><a href="/docs/history-blockchain/" class="menu-item menu-link">
            History Blockchain
          </a></div><section class="section doc-content flex-fit"><div class="section--inner container container-base"><div class="post mb"><h1 id="an-rspace-tutorial"><a href="#an-rspace-tutorial" aria-hidden="true">#</a>An RSpace tutorial</h1><h3 id="getting-started"><a href="#getting-started" aria-hidden="true">#</a>Getting Started</h3><p>To start using <code>rspace</code>, we first import the library into our project.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span></span>_</code></pre><p>Before we can start using the main <code>produce</code> and <code>consume</code> functions, we need to define data types for channels, patterns, data, and continuations.</p><p>Let's try writing types for a simple address book-style project, where we can store and retrieve information about people.</p><p>We start with a simple channel.</p><pre class="language-scala"><code class="language-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Channel<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span></code></pre><p>Our <code>Channel</code> type will encode categories of addresses, like &quot;friends&quot;, &quot;family&quot;, and &quot;colleagues&quot;.</p><p>Now let's write our types for patterns and data.</p><p>For data, we will use a type called <code>Entry</code>.</p><pre class="language-scala"><code class="language-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Name<span class="token punctuation">(</span>first<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> last<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Address<span class="token punctuation">(</span>street<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> city<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> state<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> zip<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> Entry<span class="token punctuation">(</span>name<span class="token operator">:</span> Name<span class="token punctuation">,</span> address<span class="token operator">:</span> Address<span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> phone<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span></code></pre><p>Next we will write our pattern type. We will use values of type <code>Pattern</code> for matching with values of type <code>Entry</code>.</p><pre class="language-scala"><code class="language-scala"><span class="token keyword">sealed</span> <span class="token keyword">trait</span> Pattern <span class="token keyword">extends</span> Product <span class="token keyword">with</span> Serializable
<span class="token keyword">case</span> <span class="token keyword">class</span> NameMatch<span class="token punctuation">(</span>last<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Pattern
<span class="token keyword">case</span> <span class="token keyword">class</span> CityMatch<span class="token punctuation">(</span>city<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Pattern
<span class="token keyword">case</span> <span class="token keyword">class</span> StateMatch<span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Pattern</code></pre><h3 id="defining-a-continuation-type"><a href="#defining-a-continuation-type" aria-hidden="true">#</a>Defining a Continuation Type</h3><p>In <code>rspace</code>, a continuation can be an arbitrary type just like our channels, patterns, and data (with some constraints, see below). We don't actually run the continuations in <code>rspace</code> - that is the responsibility of the caller.</p><p>However, the library was designed to be used in a context where continuations take produced data as their input.</p><p>For our purposes we will design a continuation type as a Scala class which implements <code>Function1</code>, so that it can be easily called like a function.</p><p>Our continuation will be a simple one which prints the entries it is given.</p><pre class="language-scala"><code class="language-scala"><span class="token keyword">class</span> Printer <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>List<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Unit</span><span class="token punctuation">)</span> <span class="token keyword">with</span> Serializable <span class="token punctuation">{</span>

  <span class="token keyword">def</span> apply<span class="token punctuation">(</span>entries<span class="token operator">:</span> List<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span>
    entries<span class="token punctuation">.</span>foreach <span class="token punctuation">{</span>
      <span class="token keyword">case</span> Entry<span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> email<span class="token punctuation">,</span> phone<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
        <span class="token keyword">val</span> nameStr <span class="token operator">=</span> s<span class="token string">&quot;${name.last}, ${name.first}&quot;</span>
        <span class="token keyword">val</span> addrStr <span class="token operator">=</span> s<span class="token string">&quot;${address.street}, ${address.city}, ${address.state} ${address.zip}&quot;</span>
        Console<span class="token punctuation">.</span>printf<span class="token punctuation">(</span>s<span class="token triple-quoted-string string">&quot;&quot;&quot;|
                           |=== ENTRY ===
                           |name:    $nameStr
                           |address: $addrStr
                           |email:   $email
                           |phone:   $phone
                           |&quot;&quot;&quot;</span><span class="token punctuation">.</span>stripMargin<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>As a convenience, we've provided definitions for these types in the <code>AddressBookExample</code> object in <code>examples</code> package.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span></span>AddressBookExample<span class="token punctuation">.</span>_
<span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span></span>AddressBookExample<span class="token punctuation">.</span>_</code></pre><h3 id="creating-serialize-instances"><a href="#creating-serialize-instances" aria-hidden="true">#</a>Creating <code>Serialize</code> Instances</h3><p><code>rspace</code> uses a <em>type class</em>-based API. The API places simple constraints what Scala data types we can use with <code>rspace</code>.</p><p>If you are unfamiliar with type classes, the <a href="https://typelevel.org/cats/typeclasses.html" target="_blank" rel="nofollow noopener noreferrer">Cats documentation</a> is a great place to start learning about them.</p><p>In order to use our types with <code>rspace</code>, we must provide instances of <code>rspace</code>'s <code>Serialize</code> type class for each type.</p><p>Here is the definition of the <code>Serialize</code> type class:</p><pre class="language-scala"><code class="language-scala"><span class="token doc-comment comment">/**
  * Type class for serializing and deserializing values
  *
  * <span class="token keyword">@tparam</span> A The type to serialize and deserialize.
  */</span>
<span class="token keyword">trait</span> Serialize<span class="token punctuation">[</span>A<span class="token punctuation">]</span> <span class="token punctuation">{</span>

  <span class="token keyword">def</span> encode<span class="token punctuation">(</span>a<span class="token operator">:</span> A<span class="token punctuation">)</span><span class="token operator">:</span> ByteVector

  <span class="token keyword">def</span> decode<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Throwable<span class="token punctuation">,</span> A<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>Let's try defining an instance of <code>Serialize</code> for <code>Channel</code> using Java serialization.</p><p>First we will need to import some more stuff.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token punctuation">{</span>ByteArrayInputStream<span class="token punctuation">,</span> ByteArrayOutputStream<span class="token punctuation">,</span> ObjectInputStream<span class="token punctuation">,</span> ObjectOutputStream<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token punctuation">{</span>ByteArrayInputStream<span class="token punctuation">,</span> ByteArrayOutputStream<span class="token punctuation">,</span> ObjectInputStream<span class="token punctuation">,</span> ObjectOutputStream<span class="token punctuation">}</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">scodec<span class="token punctuation">.</span>bits<span class="token punctuation">.</span></span>ByteVector
<span class="token keyword">import</span> <span class="token namespace">scodec<span class="token punctuation">.</span>bits<span class="token punctuation">.</span></span>ByteVector</code></pre><p>Now we define an instance of <code>Serialize</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">object</span> serializeChannel <span class="token keyword">extends</span> Serialize<span class="token punctuation">[</span>Channel<span class="token punctuation">]</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>
     <span class="token operator">|</span>   <span class="token keyword">def</span> encode<span class="token punctuation">(</span>channel<span class="token operator">:</span> Channel<span class="token punctuation">)</span><span class="token operator">:</span> ByteVector <span class="token operator">=</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>     <span class="token keyword">val</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> ByteArrayOutputStream<span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>       <span class="token keyword">val</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> ObjectOutputStream<span class="token punctuation">(</span>baos<span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token keyword">try</span> <span class="token punctuation">{</span> oos<span class="token punctuation">.</span>writeObject<span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span> oos<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
     <span class="token operator">|</span>       ByteVector<span class="token punctuation">.</span>view<span class="token punctuation">(</span>baos<span class="token punctuation">.</span>toByteArray<span class="token punctuation">)</span>
     <span class="token operator">|</span>     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>       baos<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>     <span class="token punctuation">}</span>
     <span class="token operator">|</span>   <span class="token punctuation">}</span>
     <span class="token operator">|</span>
     <span class="token operator">|</span>   <span class="token keyword">def</span> decode<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>Throwable<span class="token punctuation">,</span> Channel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>       <span class="token keyword">val</span> bais <span class="token operator">=</span> <span class="token keyword">new</span> ByteArrayInputStream<span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>toArray<span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>         <span class="token keyword">val</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> ObjectInputStream<span class="token punctuation">(</span>bais<span class="token punctuation">)</span>
     <span class="token operator">|</span>         <span class="token keyword">try</span> <span class="token punctuation">{</span> Right<span class="token punctuation">(</span>ois<span class="token punctuation">.</span>readObject<span class="token punctuation">.</span>asInstanceOf<span class="token punctuation">[</span>Channel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span> ois<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
     <span class="token operator">|</span>       <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>         bais<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token punctuation">}</span>
     <span class="token operator">|</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>       <span class="token keyword">case</span> ex<span class="token operator">:</span> Throwable <span class="token keyword">=&gt;</span> Left<span class="token punctuation">(</span>ex<span class="token punctuation">)</span>
     <span class="token operator">|</span>     <span class="token punctuation">}</span>
     <span class="token operator">|</span>   <span class="token punctuation">}</span>
     <span class="token operator">|</span> <span class="token punctuation">}</span>
defined <span class="token keyword">object</span> serializeChannel</code></pre><p>Let's try using it.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> chan <span class="token operator">=</span> <span class="token keyword">new</span> Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span>
chan<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel <span class="token operator">=</span> Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> roundTrippedChan <span class="token operator">=</span> serializeChannel<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>serializeChannel<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>chan<span class="token punctuation">)</span><span class="token punctuation">)</span>
roundTrippedChan<span class="token operator">:</span> Either<span class="token punctuation">[</span>Throwable<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel<span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Looking at the instance we above we could actually write a function to generate these instances for any type <code>T</code> that's a subtype of <code>scala.Serializable</code>.</p><p>In fact, we have provided this convenience function in the <code>coop.rchain.rspace.examples</code> package.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span></span>_</code></pre><p>Let's go ahead use that to make instances for our other types.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">val</span> serializeEntry<span class="token operator">:</span> Serialize<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span> <span class="token operator">=</span> makeSerializeFromSerializable<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span>
serializeEntry<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Serialize<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span><span class="token keyword">package</span>$$anon$<span class="token number">1</span><span class="token annotation punctuation">@77f4ba3</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">val</span> serializePattern<span class="token operator">:</span> Serialize<span class="token punctuation">[</span>Pattern<span class="token punctuation">]</span> <span class="token operator">=</span> makeSerializeFromSerializable<span class="token punctuation">[</span>Pattern<span class="token punctuation">]</span>
serializePattern<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Serialize<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Pattern<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span><span class="token keyword">package</span>$$anon$<span class="token number">1</span><span class="token annotation punctuation">@62567af</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">val</span> serializePrinter<span class="token operator">:</span> Serialize<span class="token punctuation">[</span>Printer<span class="token punctuation">]</span> <span class="token operator">=</span> makeSerializeFromSerializable<span class="token punctuation">[</span>Printer<span class="token punctuation">]</span>
serializePrinter<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Serialize<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span><span class="token keyword">package</span>$$anon$<span class="token number">1</span><span class="token annotation punctuation">@24a9babf</span></code></pre><p>Now we will define some example <code>Entry</code>s.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> alice <span class="token operator">=</span> Entry<span class="token punctuation">(</span>name <span class="token operator">=</span> Name<span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lincoln&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   address <span class="token operator">=</span> Address<span class="token punctuation">(</span><span class="token string">&quot;777 Ford St.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;223322&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   email <span class="token operator">=</span> <span class="token string">&quot;alicel@ringworld.net&quot;</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   phone <span class="token operator">=</span> <span class="token string">&quot;777-555-1212&quot;</span><span class="token punctuation">)</span>
alice<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry <span class="token operator">=</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> bob <span class="token operator">=</span> Entry<span class="token punctuation">(</span>name <span class="token operator">=</span> Name<span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lahblah&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 address <span class="token operator">=</span> Address<span class="token punctuation">(</span><span class="token string">&quot;1000 Main St&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;223322&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 email <span class="token operator">=</span> <span class="token string">&quot;blablah@tenex.net&quot;</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 phone <span class="token operator">=</span> <span class="token string">&quot;698-555-1212&quot;</span><span class="token punctuation">)</span>
bob<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry <span class="token operator">=</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Bob<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">1000</span> Main St<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>blablah<span class="token annotation punctuation">@tenex.net</span><span class="token punctuation">,</span><span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> carol <span class="token operator">=</span> Entry<span class="token punctuation">(</span>name <span class="token operator">=</span> Name<span class="token punctuation">(</span><span class="token string">&quot;Carol&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lahblah&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   address <span class="token operator">=</span> Address<span class="token punctuation">(</span><span class="token string">&quot;22 Goldwater Way&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Herbert&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nevada&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;334433&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   email <span class="token operator">=</span> <span class="token string">&quot;carol@blablah.org&quot;</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                   phone <span class="token operator">=</span> <span class="token string">&quot;232-555-1212&quot;</span><span class="token punctuation">)</span>
carol<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry <span class="token operator">=</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Carol<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">22</span> Goldwater Way<span class="token punctuation">,</span>Herbert<span class="token punctuation">,</span>Nevada<span class="token punctuation">,</span><span class="token number">334433</span><span class="token punctuation">)</span><span class="token punctuation">,</span>carol<span class="token annotation punctuation">@blablah.org</span><span class="token punctuation">,</span><span class="token number">232</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span></code></pre><p>Let's test out one of our other new <code>Serialize</code> instances with one of these values:</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> roundTrippedAlice <span class="token operator">=</span> serializeEntry<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>serializeEntry<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>alice<span class="token punctuation">)</span><span class="token punctuation">)</span>
roundTrippedAlice<span class="token operator">:</span> Either<span class="token punctuation">[</span>Throwable<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="creating-a-match-instance"><a href="#creating-a-match-instance" aria-hidden="true">#</a>Creating a <code>Match</code> instance</h3><p>In addition to providing instances of the <code>Serialize</code> type classe for our chosen data types, we also must provide an instance of the <code>Match</code> type class. This instance is used to match values of our <code>Pattern</code> type with values of our <code>Entry</code> type.</p><p>Here is the definition of the <code>Match</code> type class.</p><pre class="language-scala"><code class="language-scala"><span class="token doc-comment comment">/**
  * Type class for matching patterns with data.
  *
  * <span class="token keyword">@tparam</span> P A type representing patterns
  * <span class="token keyword">@tparam</span> E A type representing illegal state
  * <span class="token keyword">@tparam</span> A A type representing data
  * <span class="token keyword">@tparam</span> R A type representing a match result
  */</span>
<span class="token keyword">trait</span> Match<span class="token punctuation">[</span>P<span class="token punctuation">,</span> E<span class="token punctuation">,</span> A<span class="token punctuation">,</span> R<span class="token punctuation">]</span> <span class="token punctuation">{</span>

  <span class="token keyword">def</span> get<span class="token punctuation">(</span>p<span class="token operator">:</span> P<span class="token punctuation">,</span> a<span class="token operator">:</span> A<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span>E<span class="token punctuation">,</span> Option<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>Let's try defining an instance of <code>Match</code> for <code>Pattern</code> and <code>Entry</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">object</span> matchPatternEntry <span class="token keyword">extends</span> Match<span class="token punctuation">[</span>Pattern<span class="token punctuation">,</span> <span class="token builtin">Nothing</span><span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Entry<span class="token punctuation">]</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>   <span class="token keyword">def</span> get<span class="token punctuation">(</span>p<span class="token operator">:</span> Pattern<span class="token punctuation">,</span> a<span class="token operator">:</span> Entry<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
     <span class="token operator">|</span>     p <span class="token keyword">match</span> <span class="token punctuation">{</span>
     <span class="token operator">|</span>       <span class="token keyword">case</span> NameMatch<span class="token punctuation">(</span>last<span class="token punctuation">)</span> <span class="token keyword">if</span> a<span class="token punctuation">.</span>name<span class="token punctuation">.</span>last <span class="token operator">==</span> last        <span class="token keyword">=&gt;</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token keyword">case</span> CityMatch<span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token keyword">if</span> a<span class="token punctuation">.</span>address<span class="token punctuation">.</span>city <span class="token operator">==</span> city     <span class="token keyword">=&gt;</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token keyword">case</span> StateMatch<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token keyword">if</span> a<span class="token punctuation">.</span>address<span class="token punctuation">.</span>state <span class="token operator">==</span> state <span class="token keyword">=&gt;</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token operator">|</span>       <span class="token keyword">case</span> _                                             <span class="token keyword">=&gt;</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>
     <span class="token operator">|</span>     <span class="token punctuation">}</span>
     <span class="token operator">|</span> <span class="token punctuation">}</span>
defined <span class="token keyword">object</span> matchPatternEntry</code></pre><p>Let's see this instance in action.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> mat <span class="token operator">=</span> matchPatternEntry<span class="token punctuation">.</span>get<span class="token punctuation">(</span>NameMatch<span class="token punctuation">(</span><span class="token string">&quot;Lincoln&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alice<span class="token punctuation">)</span>
mat<span class="token operator">:</span> Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> noMat <span class="token operator">=</span> matchPatternEntry<span class="token punctuation">.</span>get<span class="token punctuation">(</span>NameMatch<span class="token punctuation">(</span><span class="token string">&quot;Lincoln&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bob<span class="token punctuation">)</span>
noMat<span class="token operator">:</span> Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><h3 id="instantiating-the-store"><a href="#instantiating-the-store" aria-hidden="true">#</a>Instantiating the Store</h3><p>First we define a temporary place to put the store's files.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Files<span class="token punctuation">,</span> Path<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Files<span class="token punctuation">,</span> Path<span class="token punctuation">}</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> storePath<span class="token operator">:</span> Path <span class="token operator">=</span> Files<span class="token punctuation">.</span>createTempDirectory<span class="token punctuation">(</span><span class="token string">&quot;rspace-address-book-example-&quot;</span><span class="token punctuation">)</span>
storePath<span class="token operator">:</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path <span class="token operator">=</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>folders<span class="token operator">/</span>rk<span class="token operator">/</span>kf3ndvw96bnd18fcrtf1vjfh0000gn<span class="token operator">/</span>T<span class="token operator">/</span>rspace<span class="token operator">-</span>address<span class="token operator">-</span>book<span class="token operator">-</span>example<span class="token operator">-</span><span class="token number">5156619535042951652</span></code></pre><p>Next we create an instance of <code>Context</code> using <code>storePath</code>. We will create our store with a maximum map size of 100MB.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span></span>Id
<span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span></span>Id

scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>effect<span class="token punctuation">.</span></span>Sync
<span class="token keyword">import</span> <span class="token namespace">cats<span class="token punctuation">.</span>effect<span class="token punctuation">.</span></span>Sync

scala<span class="token operator">&gt;</span> <span class="token keyword">implicit</span> <span class="token keyword">val</span> syncF<span class="token operator">:</span> Sync<span class="token punctuation">[</span>Id<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>catscontrib<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span>syncId
syncF<span class="token operator">:</span> cats<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>Sync<span class="token punctuation">[</span>cats<span class="token punctuation">.</span>Id<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>catscontrib<span class="token punctuation">.</span>effect<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span><span class="token keyword">package</span>$$anon$<span class="token number">1</span><span class="token annotation punctuation">@3ba63c94</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> context<span class="token operator">:</span> Context<span class="token punctuation">[</span>Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span> <span class="token operator">=</span> Context<span class="token punctuation">.</span>create<span class="token punctuation">[</span>Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span><span class="token punctuation">(</span>storePath<span class="token punctuation">,</span> <span class="token number">1024L</span> <span class="token operator">*</span> <span class="token number">1024L</span> <span class="token operator">*</span> <span class="token number">100L</span><span class="token punctuation">)</span>
context<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Context<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Pattern<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>LMDBContext<span class="token annotation punctuation">@7409b43c</span></code></pre><p>Now we can create an RSpace using the created context</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> space <span class="token operator">=</span> RSpace<span class="token punctuation">.</span>create<span class="token punctuation">[</span>Id<span class="token punctuation">,</span> Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> <span class="token builtin">Nothing</span><span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>history<span class="token punctuation">.</span>Branch<span class="token punctuation">.</span>MASTER<span class="token punctuation">)</span>
space<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>ISpace<span class="token punctuation">[</span>cats<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Pattern<span class="token punctuation">,</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>spaces<span class="token punctuation">.</span>CoarseGrainedRSpace<span class="token annotation punctuation">@7b593ab1</span></code></pre><h3 id="producing-and-consuming"><a href="#producing-and-consuming" aria-hidden="true">#</a>Producing and Consuming</h3><p>First we will install a &quot;query&quot; in the store using <code>consume</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres1 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres1<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><p>Here we are installing a continuation in the store at the &quot;friends&quot; <code>Channel</code>. This continuation will be returned to us when a piece of matching data is introduced to the store at that channel.</p><p>Now let's try introducing a piece of data to the space using <code>produce</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres1 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alice<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres1<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>If we look closely at the result, we can see that we have received back an <code>Option</code> containing a <code>&lt;function1&gt;</code> along with the data we passed to <code>produce</code>. This is because this data has satisfied the match with the <code>Pattern</code> we provided in our call to <code>consume</code>.</p><p>Let's run the continuation using a function from the <code>util</code> package.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>_

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres1<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lincoln<span class="token punctuation">,</span> Alice
address<span class="token operator">:</span> <span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   alicel<span class="token annotation punctuation">@ringworld.net</span>
phone<span class="token operator">:</span>   <span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span></code></pre><p>When we inspect the contents of the store, we notice that the store is empty. The continuation has been removed. The data was also not stored because a matching continuation was found.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Let's reinstall the same continuation.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres2 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres2<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><p>Now let's try introducing another piece of data to the space.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres2 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bob<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres2<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Bob<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">1000</span> Main St<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>blablah<span class="token annotation punctuation">@tenex.net</span><span class="token punctuation">,</span><span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Let's also run the continuation and inspect the store.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres2<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lahblah<span class="token punctuation">,</span> Bob
address<span class="token operator">:</span> <span class="token number">1000</span> Main St<span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   blablah<span class="token annotation punctuation">@tenex.net</span>
phone<span class="token operator">:</span>   <span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Now let's reinstall the the continuation and introduce another piece of data to the space.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres3 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres3<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres3 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> carol<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres3<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><p>This time we receive a <code>None</code> back from <code>produce</code>, indicating that no match has been made.</p><p>Let's inspect the contents of the store again.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Datum<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Carol<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">22</span> Goldwater Way<span class="token punctuation">,</span>Herbert<span class="token punctuation">,</span>Nevada<span class="token punctuation">,</span><span class="token number">334433</span><span class="token punctuation">)</span><span class="token punctuation">,</span>carol<span class="token annotation punctuation">@blablah.org</span><span class="token punctuation">,</span><span class="token number">232</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>Produce<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0x7f7df0d04cc2005bde1d5b58498c24296aea8eba00d096e1baa79ee31f342e76</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>WaitingContinuation<span class="token punctuation">(</span>List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>Crystal Lake<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>Consume<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0x02e56a04fd6302d086530a4b862541075aafddb91b62e2b2e0e4f9509fd8e1f9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Here we can see that that at <code>Channel(&quot;friends&quot;)</code>, we have now stored Carol's <code>Entry</code> record along with our continuations and its patterns.</p><p>Let's <code>consume</code> again, but this time, let's use a different pattern - one that will match Carol's <code>Entry</code> - returning it to us.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres4 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>NameMatch<span class="token punctuation">(</span>last <span class="token operator">=</span> <span class="token string">&quot;Lahblah&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres4<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Carol<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">22</span> Goldwater Way<span class="token punctuation">,</span>Herbert<span class="token punctuation">,</span>Nevada<span class="token punctuation">,</span><span class="token number">334433</span><span class="token punctuation">)</span><span class="token punctuation">,</span>carol<span class="token annotation punctuation">@blablah.org</span><span class="token punctuation">,</span><span class="token number">232</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>cres4<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lahblah<span class="token punctuation">,</span> Carol
address<span class="token operator">:</span> <span class="token number">22</span> Goldwater Way<span class="token punctuation">,</span> Herbert<span class="token punctuation">,</span> Nevada <span class="token number">334433</span>
email<span class="token operator">:</span>   carol<span class="token annotation punctuation">@blablah.org</span>
phone<span class="token operator">:</span>   <span class="token number">232</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span></code></pre><p>Indeed, our call to <code>consume</code> has returned another continuation along with Carol's <code>Entry</code>.</p><p>In the store, we see that there is still a waiting continuation at <code>Channel(&quot;friends&quot;)</code></p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>WaitingContinuation<span class="token punctuation">(</span>List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>Crystal Lake<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>Consume<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0x02e56a04fd6302d086530a4b862541075aafddb91b62e2b2e0e4f9509fd8e1f9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Let's produce one more time to let this sink in.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres4 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alice<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres4<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres4<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lincoln<span class="token punctuation">,</span> Alice
address<span class="token operator">:</span> <span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   alicel<span class="token annotation punctuation">@ringworld.net</span>
phone<span class="token operator">:</span>   <span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="using-multiple-channels"><a href="#using-multiple-channels" aria-hidden="true">#</a>Using Multiple Channels</h3><p>Now we are going to experiment with multiple channels. Let's first define a few more <code>Entry</code> values - one for our colleague Dan and another for our friend Erin.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> dan <span class="token operator">=</span> Entry<span class="token punctuation">(</span>name <span class="token operator">=</span> Name<span class="token punctuation">(</span><span class="token string">&quot;Dan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Walters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 address <span class="token operator">=</span> Address<span class="token punctuation">(</span><span class="token string">&quot;40 Shady Lane&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;223322&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 email <span class="token operator">=</span> <span class="token string">&quot;deejwalters@sdf.lonestar.org&quot;</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 phone <span class="token operator">=</span> <span class="token string">&quot;444-555-1212&quot;</span><span class="token punctuation">)</span>
dan<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry <span class="token operator">=</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Dan<span class="token punctuation">,</span>Walters<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">40</span> Shady Lane<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> erin <span class="token operator">=</span> Entry<span class="token punctuation">(</span>name <span class="token operator">=</span> Name<span class="token punctuation">(</span><span class="token string">&quot;Erin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rush&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                  address <span class="token operator">=</span> Address<span class="token punctuation">(</span><span class="token string">&quot;23 Market St.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Peony&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;224422&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                  email <span class="token operator">=</span> <span class="token string">&quot;erush@lasttraintogoa.net&quot;</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                  phone <span class="token operator">=</span> <span class="token string">&quot;333-555-1212&quot;</span><span class="token punctuation">)</span>
erin<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry <span class="token operator">=</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span></code></pre><p>Let's introduce Dan and Erin to the store with <code>produce</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres5 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dan<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres5<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres6 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> erin<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres6<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><p>Now let's <code>consume</code> on multiple channels, searching for our friends and colleagues who live in Idaho.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres5 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>StateMatch<span class="token punctuation">(</span><span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StateMatch<span class="token punctuation">(</span><span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres5<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Dan<span class="token punctuation">,</span>Walters<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">40</span> Shady Lane<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>cres5<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Rush<span class="token punctuation">,</span> Erin
address<span class="token operator">:</span> <span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span> Peony<span class="token punctuation">,</span> Idaho <span class="token number">224422</span>
email<span class="token operator">:</span>   erush<span class="token annotation punctuation">@lasttraintogoa.net</span>
phone<span class="token operator">:</span>   <span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Walters<span class="token punctuation">,</span> Dan
address<span class="token operator">:</span> <span class="token number">40</span> Shady Lane<span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span>
phone<span class="token operator">:</span>   <span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span></code></pre><p>Now let's do the same thing in the opposite order.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres6 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>StateMatch<span class="token punctuation">(</span><span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StateMatch<span class="token punctuation">(</span><span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres6<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres7 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dan<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres7<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres8 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> erin<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres8<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Dan<span class="token punctuation">,</span>Walters<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">40</span> Shady Lane<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres7<span class="token punctuation">)</span></code></pre><p>Note that we can provide different patterns to match with the data on each channel.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres7 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>StateMatch<span class="token punctuation">(</span><span class="token string">&quot;Idaho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CityMatch<span class="token punctuation">(</span><span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres7<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres9 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;colleagues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dan<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres9<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres10 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> erin<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres10<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Dan<span class="token punctuation">,</span>Walters<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">40</span> Shady Lane<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span><span class="token punctuation">,</span><span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres10<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Rush<span class="token punctuation">,</span> Erin
address<span class="token operator">:</span> <span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span> Peony<span class="token punctuation">,</span> Idaho <span class="token number">224422</span>
email<span class="token operator">:</span>   erush<span class="token annotation punctuation">@lasttraintogoa.net</span>
phone<span class="token operator">:</span>   <span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Walters<span class="token punctuation">,</span> Dan
address<span class="token operator">:</span> <span class="token number">40</span> Shady Lane<span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   deejwalters<span class="token annotation punctuation">@sdf.lonestar.org</span>
phone<span class="token operator">:</span>   <span class="token number">444</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span></code></pre><h3 id="making-things-stick"><a href="#making-things-stick" aria-hidden="true">#</a>Making Things Stick</h3><p>So far we've seen that every matching piece of data or continuation returned to us has also been removed from the store. We could obviously put it back into the store ourselves, but we can also use <code>produce</code> and <code>consume</code>'s persist parameter to put something in the store and &quot;make it stick&quot;.</p><p>Let's try to persist a continuation, but first let's put our Crystal Lake-dwelling friends back in the store.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres11 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alice<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres11<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres12 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bob<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
pres12<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span></code></pre><p>Now let's try to do a <code>consume</code> with the persist flag set to <code>true</code>.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres8 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
cres8<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Alice<span class="token punctuation">,</span>Lincoln<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alicel<span class="token annotation punctuation">@ringworld.net</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Look, data!</p><p>Let's run with it.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>cres8<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lincoln<span class="token punctuation">,</span> Alice
address<span class="token operator">:</span> <span class="token number">777</span> Ford St<span class="token punctuation">.</span><span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   alicel<span class="token annotation punctuation">@ringworld.net</span>
phone<span class="token operator">:</span>   <span class="token number">777</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span></code></pre><p>As a side note, we can observe the fact there is no particular order to which we retrieve matching data (or continuations). If multiple matches exist, one is non-deterministically chosen and returned to the caller.</p><p>So did our <code>consume</code> stick?</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Datum<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Bob<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">1000</span> Main St<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>blablah<span class="token annotation punctuation">@tenex.net</span><span class="token punctuation">,</span><span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>Produce<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0x7b39ca265b2cfdd27fc464b71470c3259a2ddd5f2e37e139e9d1c29ced3a6a31</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>It did not! That's strange...</p><p>This quirk of <code>rspace</code> is to address the circumstance where matches already exist for a particular continuation that we are trying to persist. If we were able to persist the continuation without retrieving the existing matches, those matches might end up &quot;lost&quot; in the store. Instead, we should keep re-attempting to do a persistent consume until all existing matches have been &quot;drained&quot; from the store. When we receive a <code>None</code>, we know that all existing matches have been returned from the store and the continuation has been persisted.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres9 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
cres9<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Bob<span class="token punctuation">,</span>Lahblah<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">1000</span> Main St<span class="token punctuation">,</span>Crystal Lake<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">223322</span><span class="token punctuation">)</span><span class="token punctuation">,</span>blablah<span class="token annotation punctuation">@tenex.net</span><span class="token punctuation">,</span><span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>cres9<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Lahblah<span class="token punctuation">,</span> Bob
address<span class="token operator">:</span> <span class="token number">1000</span> Main St<span class="token punctuation">,</span> Crystal Lake<span class="token punctuation">,</span> Idaho <span class="token number">223322</span>
email<span class="token operator">:</span>   blablah<span class="token annotation punctuation">@tenex.net</span>
phone<span class="token operator">:</span>   <span class="token number">698</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres10 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
cres10<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>WaitingContinuation<span class="token punctuation">(</span>List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>Crystal Lake<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>Consume<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xb04ae03458e620b9c3d06148d5e651fa91c2bb0575ea1f6e5e91ebbf197b6695</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>The same rule applies for doing a persistent <code>produce</code> - if any matching continuations exist in the store, they must be drained before the data will be persisted.</p><p>For example,</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres11 <span class="token operator">=</span> space<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Peony&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> Printer<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres11<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres13 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> erin<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
pres13<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> runK<span class="token punctuation">(</span>pres13<span class="token punctuation">)</span>

<span class="token operator">==</span><span class="token operator">=</span> ENTRY <span class="token operator">==</span><span class="token operator">=</span>
name<span class="token operator">:</span>    Rush<span class="token punctuation">,</span> Erin
address<span class="token operator">:</span> <span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span> Peony<span class="token punctuation">,</span> Idaho <span class="token number">224422</span>
email<span class="token operator">:</span>   erush<span class="token annotation punctuation">@lasttraintogoa.net</span>
phone<span class="token operator">:</span>   <span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span>

scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>WaitingContinuation<span class="token punctuation">(</span>List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>Crystal Lake<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>Consume<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xb04ae03458e620b9c3d06148d5e651fa91c2bb0575ea1f6e5e91ebbf197b6695</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> pres14 <span class="token operator">=</span> space<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> erin<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
pres14<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> println<span class="token punctuation">(</span>space<span class="token punctuation">.</span>store<span class="token punctuation">.</span>toMap<span class="token punctuation">)</span>
Map<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Row<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Datum<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>Name<span class="token punctuation">(</span>Erin<span class="token punctuation">,</span>Rush<span class="token punctuation">)</span><span class="token punctuation">,</span>Address<span class="token punctuation">(</span><span class="token number">23</span> Market St<span class="token punctuation">.</span><span class="token punctuation">,</span>Peony<span class="token punctuation">,</span>Idaho<span class="token punctuation">,</span><span class="token number">224422</span><span class="token punctuation">)</span><span class="token punctuation">,</span>erush<span class="token annotation punctuation">@lasttraintogoa.net</span><span class="token punctuation">,</span><span class="token number">333</span><span class="token operator">-</span><span class="token number">555</span><span class="token operator">-</span><span class="token number">1212</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>Produce<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0x7d664473c31bd1b7a7bed21ec1794a509f9ea8d7eaa206657da7c9cf52fd51f6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>List<span class="token punctuation">(</span>WaitingContinuation<span class="token punctuation">(</span>List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>Crystal Lake<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token generics"><span class="token punctuation">&lt;</span>function1<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>Consume<span class="token punctuation">(</span>channels<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xeac5571fbf9fc71f19d65e14314b32ad06538a364c2ff101edfa99a969fac35b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xb04ae03458e620b9c3d06148d5e651fa91c2bb0575ea1f6e5e91ebbf197b6695</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="history--rollback"><a href="#history--rollback" aria-hidden="true">#</a>History &amp; rollback</h3><p>It is possible to save the current state of RSpace in the form of a <code>Checkpoint</code>. A <code>Checkpoint</code> value contains the root hash of a Merkle Patricia Trie built from the contents of RSpace.</p><pre class="language-scala"><code class="language-scala"><span class="token keyword">val</span> checkpoint <span class="token operator">=</span> space<span class="token punctuation">.</span>createCheckpoint<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> checkpointHash <span class="token operator">=</span> checkpoint<span class="token punctuation">.</span>root</code></pre><p>To rollback the state of the RSpace to a given <code>Checkpoint</code> one simply calls the <code>reset</code> method with the hash of the root of the <code>Checkpoint</code> provided as parameter.</p><pre class="language-scala"><code class="language-scala">space<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>checkpointHash<span class="token punctuation">)</span></code></pre><p>Let's see how this works in practice. We'll start by creating a new, untouched RSpace followed by a consume operation which should put data and a continuation at given channel.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> rollbackExampleStorePath<span class="token operator">:</span> Path <span class="token operator">=</span> Files<span class="token punctuation">.</span>createTempDirectory<span class="token punctuation">(</span><span class="token string">&quot;rspace-address-book-example-&quot;</span><span class="token punctuation">)</span>
rollbackExampleStorePath<span class="token operator">:</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Path <span class="token operator">=</span> <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>folders<span class="token operator">/</span>rk<span class="token operator">/</span>kf3ndvw96bnd18fcrtf1vjfh0000gn<span class="token operator">/</span>T<span class="token operator">/</span>rspace<span class="token operator">-</span>address<span class="token operator">-</span>book<span class="token operator">-</span>example<span class="token operator">-</span><span class="token number">7312415577584704503</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> rollbackExampleContext<span class="token operator">:</span> Context<span class="token punctuation">[</span>Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span> <span class="token operator">=</span> Context<span class="token punctuation">.</span>create<span class="token punctuation">[</span>Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span><span class="token punctuation">(</span>rollbackExampleStorePath<span class="token punctuation">,</span>  <span class="token number">1024L</span> <span class="token operator">*</span> <span class="token number">1024L</span> <span class="token operator">*</span> <span class="token number">100L</span><span class="token punctuation">)</span>
rollbackExampleContext<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Context<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Pattern<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>LMDBContext<span class="token annotation punctuation">@1deea8b</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> rollbackExampleSpace <span class="token operator">=</span> RSpace<span class="token punctuation">.</span>create<span class="token punctuation">[</span>Id<span class="token punctuation">,</span> Channel<span class="token punctuation">,</span> Pattern<span class="token punctuation">,</span> <span class="token builtin">Nothing</span><span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Entry<span class="token punctuation">,</span> Printer<span class="token punctuation">]</span><span class="token punctuation">(</span>rollbackExampleContext<span class="token punctuation">,</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>history<span class="token punctuation">.</span>Branch<span class="token punctuation">.</span>MASTER<span class="token punctuation">)</span>
rollbackExampleSpace<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>ISpace<span class="token punctuation">[</span>cats<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Channel<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Pattern<span class="token punctuation">,</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">,</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>spaces<span class="token punctuation">.</span>CoarseGrainedRSpace<span class="token annotation punctuation">@5646a9e4</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> cres <span class="token operator">=</span>
     <span class="token operator">|</span>   rollbackExampleSpace<span class="token punctuation">.</span>consume<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 List<span class="token punctuation">(</span>CityMatch<span class="token punctuation">(</span>city <span class="token operator">=</span> <span class="token string">&quot;Crystal Lake&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token operator">|</span>                 <span class="token keyword">new</span> Printer<span class="token punctuation">,</span>
     <span class="token operator">|</span>                 persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
cres<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>immutable<span class="token punctuation">.</span>Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Right<span class="token punctuation">(</span>None<span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> cres<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">.</span>isEmpty
res19<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><p>We can now create a checkpoint and store it's root.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> checkpointHash <span class="token operator">=</span> rollbackExampleSpace<span class="token punctuation">.</span>createCheckpoint<span class="token punctuation">.</span>root
checkpointHash<span class="token operator">:</span> coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>Blake2b256Hash <span class="token operator">=</span> Blake2b256Hash<span class="token punctuation">(</span>bytes<span class="token operator">:</span> ByteVector<span class="token punctuation">(</span><span class="token number">32</span> bytes<span class="token punctuation">,</span> <span class="token number">0xc9304533ab01f488ffe0692cc42f3b2cb7f231323efe32ee2e3802cd42086719</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>The first <code>produceAlice</code> operation should be able to find data stored by the consume.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">def</span> produceAlice<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token punctuation">(</span>Printer<span class="token punctuation">,</span> Seq<span class="token punctuation">[</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> rollbackExampleSpace<span class="token punctuation">.</span>produce<span class="token punctuation">(</span>Channel<span class="token punctuation">(</span><span class="token string">&quot;friends&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> alice<span class="token punctuation">,</span> persist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
produceAlice<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>Either<span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span>Option<span class="token punctuation">[</span><span class="token punctuation">(</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Printer<span class="token punctuation">,</span> Seq<span class="token punctuation">[</span>coop<span class="token punctuation">.</span>rchain<span class="token punctuation">.</span>rspace<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>AddressBookExample<span class="token punctuation">.</span>Entry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

scala<span class="token operator">&gt;</span> produceAlice<span class="token punctuation">.</span>toOption<span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>isDefined
res20<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><p>Running the same operation again shouldn't return anything, as data hasn't been persisted.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> produceAlice<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">.</span>isEmpty
res21<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><p>Every following repetition of the operation above should yield an empty result.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> produceAlice<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">.</span>isEmpty
res22<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><p>After re-setting the RSpace to the state from the saved checkpoint the first produce operation should again return an non-empty result.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> rollbackExampleSpace<span class="token punctuation">.</span>reset<span class="token punctuation">(</span>checkpointHash<span class="token punctuation">)</span>
res23<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> produceAlice<span class="token punctuation">.</span>toOption<span class="token punctuation">.</span>flatten<span class="token punctuation">.</span>isDefined
res24<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><p>And again, every following operation should yield an empty result
Every following repetition of the operation above should yield an empty result.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> produceAlice<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">.</span>isEmpty
res25<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><h3 id="finishing-up"><a href="#finishing-up" aria-hidden="true">#</a>Finishing Up</h3><p>When we are finished using the spaces, we close them.</p><pre class="language-scala"><code class="language-scala">scala<span class="token operator">&gt;</span> space<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
res26<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

scala<span class="token operator">&gt;</span> rollbackExampleSpace<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
res27<span class="token operator">:</span> cats<span class="token punctuation">.</span>Id<span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><a href="https://github.com/rchain-community/rchain-community.github.io/tree/source/content/docs/rspace-tut.md" target="_blank" class="github-edit-link"><svg width="16" height="16" viewBox="0 0 438.549 438.549"><path fill="currentColor" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></svg><span>Edit this page on GitHub</span></a></p><nav class="docs-nav"><div class="docs-nav__previous"><a href="/docs/rspace-intro/" class="button  button--small docs-nav__link">
            ← Overview
          </a></div><div class="docs-nav__next"><a href="/docs/rspace-tut-rust/" class="button  button--small docs-nav__link">
            Implementation Rust →
          </a></div></nav></div><!----></section><!----></div></div>
    <script>window.__INITIAL_STATE__={"data":{"doc":{"title":"An RSpace tutorial","headings":[{"value":"An RSpace tutorial"}],"subtitles":[{"depth":1,"value":"An RSpace tutorial","anchor":"#an-rspace-tutorial"},{"depth":3,"value":"Getting Started","anchor":"#getting-started"},{"depth":3,"value":"Defining a Continuation Type","anchor":"#defining-a-continuation-type"},{"depth":3,"value":"Creating Serialize Instances","anchor":"#creating-serialize-instances"},{"depth":3,"value":"Creating a Match instance","anchor":"#creating-a-match-instance"},{"depth":3,"value":"Instantiating the Store","anchor":"#instantiating-the-store"},{"depth":3,"value":"Producing and Consuming","anchor":"#producing-and-consuming"},{"depth":3,"value":"Using Multiple Channels","anchor":"#using-multiple-channels"},{"depth":3,"value":"Making Things Stick","anchor":"#making-things-stick"},{"depth":3,"value":"History & rollback","anchor":"#history--rollback"},{"depth":3,"value":"Finishing Up","anchor":"#finishing-up"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.8489218a.js" defer></script>
  </body>
</html>